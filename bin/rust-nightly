#!/bin/bash
set -e

URL=http://static.rust-lang.org/dist/rust-nightly-x86_64-apple-darwin.tar.gz

DIR=`brew --cellar`/rust/HEAD

trap 'test -e ${TMPFILE} && rm -f ${TMPFILE}' EXIT INT TERM
TMPFILE=`mktemp -t rust-upgrade`

curl -o ${TMPFILE} ${URL}

brew unlink rust || true
rm -rf ${DIR}
mkdir -p ${DIR}
tar -C ${DIR} --strip-components 1 -zxf ${TMPFILE}
cp ${TMPFILE} ${DIR}/`basename ${URL}`
brew link rust
